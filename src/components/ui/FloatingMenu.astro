---
import { Icon } from "astro-icon/components";

const items = [
  { label: 'Home', href: '/' },
  { label: 'About', href: '/about' },
  { label: 'Workshops', href: '/events' },
  { label: 'Contact', href: '/contact' },
];
---

<style>
  /* Optional: subtle glow for the tech vibe */
  .glow {
    box-shadow: 0 0 0.1rem rgba(83,242,232,.6), 0 0 0.8rem rgba(0,214,255,.35);
  }
</style>

<div
  class="fixed top-4 right-4 z-[1000] pointer-events-auto"
  aria-live="polite"
>
  <div class="relative">
    <button
      id="akili-fab"
      class="glow inline-flex h-12 w-12 items-center justify-center rounded-full bg-neutral-900 text-white outline-none ring-1 ring-neutral-800 hover:ring-neutral-700 focus-visible:ring-2 focus-visible:ring-cyan-400"
      aria-haspopup="menu"
      aria-expanded="false"
      aria-controls="akili-fab-menu"
      title="Open menu"
      type="button"
    >
      <!-- minimalist "kebab" icon -->
      <span class="sr-only">Open menu</span>
      <Icon name="tabler:menu-2" class="h-6 w-6" />
    </button>

    <div
      id="akili-fab-menu"
      class="invisible opacity-0 translate-y-1 transition
             absolute right-0 mt-2 min-w-48 overflow-hidden rounded-xl"
      role="menu"
      aria-labelledby="akili-fab"
      tabindex="-1"
    >
      <ul class="py-1">
        {items.map((it) => (
          <li>
            <a
              class="block px-4 py-2 text-sm text-neutral-200 hover:bg-neutral-800 focus:bg-neutral-800 focus:outline-none"
              href={it.href}
              role="menuitem"
              tabindex="-1"
            >
              {it.label}
            </a>
          </li>
        ))}
      </ul>
    </div>
  </div>
</div>

<script type="module">
  // Vanilla JS; no framework directive needed.
  const btn = document.getElementById('akili-fab');
  const menu = document.getElementById('akili-fab-menu');

  function openMenu() {
    menu.classList.remove('invisible', 'opacity-0', 'translate-y-1');
    btn.setAttribute('aria-expanded', 'true');
    // focus first item
    const first = menu.querySelector('[role="menuitem"]');
    first && first.focus();
    // trap-ish: move focus back to button if Shift+Tab from first
    menu.addEventListener('keydown', trapOnce, { once: true });
  }

  function closeMenu() {
    menu.classList.add('invisible', 'opacity-0', 'translate-y-1');
    btn.setAttribute('aria-expanded', 'false');
  }

  function isOpen() {
    return !menu.classList.contains('invisible');
  }

  function toggleMenu() {
    isOpen() ? closeMenu() : openMenu();
  }

  function onDocClick(e) {
    if (!isOpen()) return;
    if (!menu.contains(e.target) && !btn.contains(e.target)) {
      closeMenu();
    }
  }

  function onKey(e) {
    if (!isOpen()) return;
    if (e.key === 'Escape') {
      closeMenu();
      btn.focus();
    }
  }

  function trapOnce(e) {
    if (e.key === 'Tab' && e.shiftKey) {
      e.preventDefault();
      btn.focus();
    }
  }

  btn.addEventListener('click', toggleMenu);
  document.addEventListener('click', onDocClick);
  document.addEventListener('keydown', onKey);
</script>
